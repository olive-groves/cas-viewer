var Fe=r=>{throw TypeError(r)};var Ae=(r,e,t)=>e.has(r)||Fe("Cannot "+t);var x=(r,e,t)=>(Ae(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?Fe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Ce=(r,e,t,a)=>(Ae(r,e,"write to private field"),a?a.call(r,t):e.set(r,t),t);import{c as B,a as C,t as N}from"../chunks/D-rTD1zK.js";import{j as Z,y as Te,t as rt,ae as we,N as at,e as nt,z as st,g as u,ah as it,a9 as ot,aa as Ie,x as Pe,k as ie,A as lt,ab as Be,h as Ue,ac as dt,aA as Ee,F as Ge,J as Oe,av as ut,ak as ct,a3 as ye,aB as ft,aC as vt,D as mt,aD as ht,i as yt,aE as gt,aF as _t,v as wt,Q as xt,ad as bt,q as kt,Z as Lt,aG as St,c as b,p as ee,u as w,d as A,a as te,f as T,n as re,R as I,s as z,S as D,$ as Je,b as H,aH as He}from"../chunks/bpzMgHyU.js";import{l as Ct,d as Ke,e as E}from"../chunks/gPzIt8b8.js";import{r as Q,p as K,s as xe,a as R,i as me}from"../chunks/Bg9peqaP.js";import{g as be,s as F,b as Re,c as Pt,p as Et,d as pt,e as zt,r as p,m as Tt,f as he,x as Mt,V as Rt,a as Dt,M as Ft,h as At,P as It}from"../chunks/Bz_5M5Oj.js";import{s as ae}from"../chunks/DGCYO2xW.js";import{a as ke}from"../chunks/D9UleubV.js";function Ne(r,e){Z&&Te(rt(r)),we(()=>{var t=e();for(var a in t){var s=t[a];s?r.style.setProperty(a,s):r.style.removeProperty(a)}}),at(()=>{r.remove()})}function Ot(r,e){return e}function Ht(r,e,t,a){for(var s=[],n=e.length,o=0;o<n;o++)vt(e[o].e,s,!0);var d=n>0&&s.length===0&&t!==null;if(d){var v=t.parentNode;mt(v),v.append(t),a.clear(),V(r,e[0].prev,e[n-1].next)}ht(s,()=>{for(var _=0;_<n;_++){var l=e[_];d||(a.delete(l.k),V(r,l.prev,l.next)),yt(l.e,!d)}})}function Nt(r,e,t,a,s,n=null){var o=r,d={flags:e,items:new Map,first:null};Z&&st();var v=null,_=!1,l=it(()=>{var c=t();return xt(c)?c:c==null?[]:Ge(c)});nt(()=>{var c=u(l),f=c.length;if(_&&f===0)return;_=f===0;let h=!1;if(Z){var m=o.data===ot;m!==(f===0)&&(o=Ie(),Te(o),Pe(!1),h=!0)}if(Z){for(var k=null,L,g=0;g<f;g++){if(ie.nodeType===8&&ie.data===lt){o=ie,h=!0,Pe(!1);break}var P=c[g],j=a(P,g);L=Qe(ie,d,k,null,P,j,g,s,e,t),d.items.set(j,L),k=L}f>0&&Te(Ie())}Z||Yt(c,d,o,s,e,a,t),n!==null&&(f===0?v?Be(v):v=Ue(()=>n(o)):v!==null&&dt(v,()=>{v=null})),h&&Pe(!0),u(l)}),Z&&(o=ie)}function Yt(r,e,t,a,s,n,o){var d=r.length,v=e.items,_=e.first,l=_,c,f=null,h=[],m=[],k,L,g,P;for(P=0;P<d;P+=1){if(k=r[P],L=n(k,P),g=v.get(L),g===void 0){var j=l?l.e.nodes_start:t;f=Qe(j,e,f,f===null?e.first:f.next,k,L,P,a,s,o),v.set(L,f),h=[],m=[],l=f.next;continue}if(Xt(g,k,P),g.e.f&Ee&&Be(g.e),g!==l){if(c!==void 0&&c.has(g)){if(h.length<m.length){var q=m[0],i;f=q.prev;var y=h[0],S=h[h.length-1];for(i=0;i<h.length;i+=1)Ye(h[i],q,t);for(i=0;i<m.length;i+=1)c.delete(m[i]);V(e,y.prev,S.next),V(e,f,y),V(e,S,q),l=q,f=S,P-=1,h=[],m=[]}else c.delete(g),Ye(g,l,t),V(e,g.prev,g.next),V(e,g,f===null?e.first:f.next),V(e,f,g),f=g;continue}for(h=[],m=[];l!==null&&l.k!==L;)l.e.f&Ee||(c??(c=new Set)).add(l),m.push(l),l=l.next;if(l===null)continue;g=l}h.push(g),f=g,l=g.next}if(l!==null||c!==void 0){for(var Y=c===void 0?[]:Ge(c);l!==null;)l.e.f&Ee||Y.push(l),l=l.next;var ne=Y.length;if(ne>0){var Le=null;Ht(e,Y,Le,v)}}Oe.first=e.first&&e.first.e,Oe.last=f&&f.e}function Xt(r,e,t,a){ut(r.v,e),r.i=t}function Qe(r,e,t,a,s,n,o,d,v,_){var l=(v&gt)!==0,c=(v&_t)===0,f=l?c?ct(s):ye(s):s,h=v&ft?ye(o):o,m={i:h,v:f,k:n,a:null,e:null,prev:t,next:a};try{return m.e=Ue(()=>d(r,f,h,_),Z),m.e.prev=t&&t.e,m.e.next=a&&a.e,t===null?e.first=m:(t.next=m,t.e.next=m.e),a!==null&&(a.prev=m,a.e.prev=m.e),m}finally{}}function Ye(r,e,t){for(var a=r.next?r.next.e.nodes_start:t,s=e?e.e.nodes_start:t,n=r.e.nodes_start;n!==a;){var o=wt(n);s.before(n),n=o}}function V(r,e,t){e===null?r.first=t:(e.next=t,e.e.next=t&&t.e),t!==null&&(t.prev=e,t.e.prev=e&&e.e)}function jt(r,e,t){bt(()=>{var a=kt(()=>e(r,t==null?void 0:t())||{});if(t&&(a!=null&&a.update)){var s=!1,n={};we(()=>{var o=t();Lt(o),s&&St(n,o)&&(n=o,a.update(o))}),s=!0}if(a!=null&&a.destroy)return()=>a.destroy()})}const qt=()=>performance.now(),O={tick:r=>requestAnimationFrame(r),now:()=>qt(),tasks:new Set};function We(){const r=O.now();O.tasks.forEach(e=>{e.c(r)||(O.tasks.delete(e),e.f())}),O.tasks.size!==0&&O.tick(We)}function Vt(r){let e;return O.tasks.size===0&&O.tick(We),{promise:new Promise(t=>{O.tasks.add(e={c:r,f:t})}),abort(){O.tasks.delete(e)}}}function pe(r,e,t=e){Ct(r,"change",()=>{t(r.files)}),Z&&r.files&&t(r.files),we(()=>{r.files=e()})}function Zt(r){return r}function Xe(r){return r<.5?4*r*r*r:.5*Math.pow(2*r-2,3)+1}function je(r){return Object.prototype.toString.call(r)==="[object Date]"}function Me(r,e){if(r===e||r!==r)return()=>r;const t=typeof r;if(t!==typeof e||Array.isArray(r)!==Array.isArray(e))throw new Error("Cannot interpolate values of different type");if(Array.isArray(r)){const a=e.map((s,n)=>Me(r[n],s));return s=>a.map(n=>n(s))}if(t==="object"){if(!r||!e)throw new Error("Object cannot be null");if(je(r)&&je(e)){const n=r.getTime(),d=e.getTime()-n;return v=>new Date(n+v*d)}const a=Object.keys(e),s={};return a.forEach(n=>{s[n]=Me(r[n],e[n])}),n=>{const o={};return a.forEach(d=>{o[d]=s[d](n)}),o}}if(t==="number"){const a=e-r;return s=>r+s*a}return()=>e}var X,$,oe,J;const De=class De{constructor(e,t={}){M(this,X,ye(void 0));M(this,$,ye(void 0));M(this,oe);M(this,J,null);x(this,X).v=x(this,$).v=e,Ce(this,oe,t)}static of(e,t){const a=new De(e(),t);return we(()=>{a.set(e())}),a}set(e,t){var c;b(x(this,$),e);let{delay:a=0,duration:s=400,easing:n=Zt,interpolate:o=Me}={...x(this,oe),...t};if(s===0)return(c=x(this,J))==null||c.abort(),b(x(this,X),e),Promise.resolve();const d=O.now()+a;let v,_=!1,l=x(this,J);return Ce(this,J,Vt(f=>{if(f<d)return!0;if(!_){_=!0;const m=x(this,X).v;v=o(m,e),typeof s=="function"&&(s=s(m,e)),l==null||l.abort()}const h=f-d;return h>s?(b(x(this,X),e),!1):(b(x(this,X),v(n(h/s))),!0)})),x(this,J).promise}get current(){return u(x(this,X))}get target(){return u(x(this,$))}set target(e){this.set(e)}};X=new WeakMap,$=new WeakMap,oe=new WeakMap,J=new WeakMap;let ge=De;function Bt(r,e){ee(e,!0);let t=Q(e,["$$slots","$$events","$$legacy","source"]);const a=be();if(!a.map)throw new Error("Map instance is not initialized.");const s=A(()=>e.source??Re().id);w(()=>{a.userTerrain=F({...t,source:u(s)}),a.waitForStyleLoaded(n=>{n.setTerrain(a.userTerrain||null)})}),ke(()=>{a.userTerrain=void 0,a.waitForStyleLoaded(n=>{n.setTerrain(a.baseTerrain??null)})}),te()}function $e(r,e){ee(e,!0);let t=K(e,"source",15,void 0),a=Q(e,["$$slots","$$events","$$legacy","source","id","children"]);a=a;const s=be();if(!s.map)throw new Error("Map instance is not initialized.");let n=!0;const o=e.id??Pt(),d=Et();d.id=o,s.waitForStyleLoaded(l=>{s.addSource(o,F(a)),t(l.getSource(o)),n=!0}),w(()=>{t()&&e.type!=="canvas"&&e.type!=="video"&&e.type!=="image"&&(t(t().maxzoom=e.maxzoom??22,!0),e.type!=="geojson"&&t(t().minzoom=e.minzoom??0,!0))}),w(()=>{t()&&(e.type==="vector"||e.type==="raster"||e.type==="raster-dem")&&(e.tiles,!n&&"setTiles"in t()&&t().setTiles(e.tiles??[]))}),w(()=>{t()&&(e.type==="vector"||e.type==="raster"||e.type==="raster-dem")&&(e.url,!n&&"setUrl"in t()&&t().setUrl(e.url))}),w(()=>{t()&&e.type==="image"&&(e.url,n||t().updateImage({url:e.url}))}),w(()=>{if(t()&&(e.type==="image"||e.type==="video"||e.type==="canvas")&&(e.coordinates,!n)){if(!("setCoordinates"in t()))throw new Error("setCoordinates method is not supported");t().setCoordinates(e.coordinates)}}),w(()=>{if(e.type==="canvas"&&(e.animate,t()&&e.animate!==void 0&&!n)){const l=t();e.animate?l.play():l.pause()}}),w(()=>{t()&&e.type==="geojson"&&(e.data,n||t().setData(e.data))}),w(()=>{t()&&e.type==="geojson"&&(e.cluster,e.clusterMaxZoom,e.clusterRadius,n||(e.clusterRadius!==void 0&&t(t().workerOptions.superclusterOptions.radius=e.clusterRadius*(8192/t().tileSize),!0),t().setClusterOptions({cluster:e.cluster,clusterMaxZoom:e.clusterMaxZoom})))}),w(()=>{t(),n=!1}),ke(()=>{s.removeSource(o),t(void 0)});var v=B(),_=T(v);ae(_,()=>e.children??re),C(r,v),te()}function qe(r,e){let t=K(e,"source",15,void 0),a=Q(e,["$$slots","$$events","$$legacy","source","id","children"]);$e(r,xe({get id(){return e.id},type:"raster"},()=>a,{get source(){return t()},set source(s){t(s)},children:(s,n)=>{var o=B(),d=T(o);ae(d,()=>e.children??re),C(s,o)},$$slots:{default:!0}}))}function Ve(r,e){let t=K(e,"source",15,void 0),a=Q(e,["$$slots","$$events","$$legacy","source","id","children"]);$e(r,xe({get id(){return e.id},type:"raster-dem"},()=>a,{get source(){return t()},set source(s){t(s)},children:(s,n)=>{var o=B(),d=T(o);ae(d,()=>e.children??re),C(s,o)},$$slots:{default:!0}}))}function et(r,e){ee(e,!0);const t=be();if(!t.map)throw new Error("Map instance is not initialized.");const a=e.id??pt(),s=zt();s.id=a;const n={id:a,type:e.type,layout:F(e.layout)??{},paint:F(e.paint)??{}};n.type!=="background"&&(n.source=e.source??Re().id),e.maxzoom!==void 0&&(n.maxzoom=e.maxzoom),e.minzoom!==void 0&&(n.minzoom=e.minzoom),e.metadata!==void 0&&(n.metadata=e.metadata),n.type!=="background"&&(e["source-layer"]&&(n["source-layer"]=e["source-layer"]),e.filter&&(n.filter=F(e.filter)));let o=!0;t.waitForStyleLoaded(()=>{t.addLayer(n,e.beforeId)}),w(()=>p(t.map,"click",a,e.onclick)),w(()=>p(t.map,"dblclick",a,e.ondblclick)),w(()=>p(t.map,"mousedown",a,e.onmousedown)),w(()=>p(t.map,"mouseup",a,e.onmouseup)),w(()=>p(t.map,"mousemove",a,e.onmousemove)),w(()=>p(t.map,"mouseenter",a,e.onmouseenter)),w(()=>p(t.map,"mouseleave",a,e.onmouseleave)),w(()=>p(t.map,"mouseover",a,e.onmouseover)),w(()=>p(t.map,"mouseout",a,e.onmouseout)),w(()=>p(t.map,"contextmenu",a,e.oncontextmenu)),w(()=>p(t.map,"touchstart",a,e.ontouchstart)),w(()=>p(t.map,"touchend",a,e.ontouchend)),w(()=>p(t.map,"touchcancel",a,e.ontouchcancel));let d=F(e.paint)??{};w(()=>{e.paint,o||t.waitForStyleLoaded(c=>{const f=new Set(Object.keys(d)),h=F(e.paint)??{};for(const[m,k]of Object.entries(h))f.delete(m),d[m]!==k&&c.setPaintProperty(a,m,k);for(const m of f)c.setPaintProperty(a,m,void 0);d=h})});let v=F(e.layout)??{};w(()=>{e.layout,o||t.waitForStyleLoaded(c=>{const f=new Set(Object.keys(v)),h=F(e.layout)??{};for(const[m,k]of Object.entries(h))f.delete(m),v[m]!==k&&c.setLayoutProperty(a,m,k);for(const m of f)c.setLayoutProperty(a,m,void 0);v=h})}),w(()=>{(e.minzoom!==void 0||e.maxzoom!==void 0)&&!o&&t.waitForStyleLoaded(c=>{c.setLayerZoomRange(a,e.minzoom??0,e.maxzoom??22)})}),w(()=>{e.filter,o||t.waitForStyleLoaded(c=>{c.setFilter(a,F(e.filter))})}),w(()=>{e.beforeId&&!o&&t.waitForStyleLoaded(c=>{c.moveLayer(a,e.beforeId)})}),w(()=>{o=!1}),ke(()=>{t.removeLayer(a)});var _=B(),l=T(_);ae(l,()=>e.children??re),C(r,_),te()}function Ze(r,e){let t=Q(e,["$$slots","$$events","$$legacy","children","sourceLayer"]);et(r,xe({type:"raster",get"source-layer"(){return e.sourceLayer}},()=>t,{children:(a,s)=>{var n=B(),o=T(n);ae(o,()=>e.children??re),C(a,n)},$$slots:{default:!0}}))}function Ut(r,e){let t=Q(e,["$$slots","$$events","$$legacy","children","sourceLayer"]);et(r,xe({type:"hillshade",get"source-layer"(){return e.sourceLayer}},()=>t,{children:(a,s)=>{var n=B(),o=T(n);ae(o,()=>e.children??re),C(a,n)},$$slots:{default:!0}}))}function Gt(r,e){ee(e,!0);let t=Q(e,["$$slots","$$events","$$legacy","position","source"]);const a=be();if(!a.map)throw new Error("Map instance is not initialized.");const s=A(()=>({source:e.source??Re().id,...t}));let n=null;w(()=>{var o,d;n&&((o=a.map)==null||o.removeControl(n)),n=new Tt.TerrainControl(F(u(s))),(d=a.map)==null||d.addControl(n,e.position)}),ke(()=>{var o;n&&((o=a.map)==null||o.removeControl(n))}),te()}var Jt=N('<div class="menu svelte-xhgsxv"><form class="svelte-xhgsxv"><div><label class="title svelte-xhgsxv" for="rgb">RGB (raster)</label> <input id="rgb" type="file"></div> <div><label class="title svelte-xhgsxv" for="height">Height (raster-dem)</label> <input id="height" type="file"></div> <div><label class="title svelte-xhgsxv" for="nan">NaNs (raster)</label> <input id="nan" type="file"></div></form> <button>Load</button></div>');function Kt(r,e){let t=K(e,"files",15),a=K(e,"files_dem",15),s=K(e,"files_overlay",15),n=H(-1);var o=Jt(),d=I(o),v=I(d),_=z(I(v),2);D(v);var l=z(v,2),c=z(I(l),2);D(l);var f=z(l,2),h=z(I(f),2);D(f),D(d);var m=z(d,2);m.__click=function(...k){var L;(L=e.loaded)==null||L.apply(this,k)},D(o),Je(()=>{he(_,`${(u(n)===0?"dragged":"")??""} svelte-xhgsxv`),he(c,`${(u(n)===1?"dragged":"")??""} svelte-xhgsxv`),he(h,`${(u(n)===2?"dragged":"")??""} svelte-xhgsxv`)}),E("dragenter",_,()=>b(n,0)),E("dragover",_,()=>b(n,0)),E("dragleave",_,()=>b(n,-1)),E("drop",_,()=>b(n,0)),pe(_,t),E("dragenter",c,()=>b(n,1)),E("dragover",c,()=>b(n,1)),E("dragleave",c,()=>b(n,-1)),E("drop",c,()=>b(n,1)),pe(c,a),E("dragenter",h,()=>b(n,2)),E("dragover",h,()=>b(n,2)),E("dragleave",h,()=>b(n,-1)),E("drop",h,()=>b(n,2)),pe(h,s),C(r,o)}Ke(["click"]);var le,de,_e;class ze{constructor(e){M(this,le,H());M(this,de,H());M(this,_e,A(()=>{var e,t;return`pmtiles://${(t=(e=this.pmtiles)==null?void 0:e.source)==null?void 0:t.getKey()}`}));e&&(this.files=e)}get pmtiles(){return u(x(this,de))}set pmtiles(e){b(x(this,de),R(e))}get url(){return u(x(this,_e))}set files(e){b(x(this,le),R(e)),e.length&&(this.pmtiles=new Mt(new Rt(e[0])))}get files(){return u(x(this,le))}get header(){var e;return(e=this==null?void 0:this.pmtiles)==null?void 0:e.getHeader()}get metadata(){var e;return(e=this==null?void 0:this.pmtiles)==null?void 0:e.getMetadata()}}le=new WeakMap,de=new WeakMap,_e=new WeakMap;var ue,ce,fe,ve;class Qt{constructor(){M(this,ue,H(R(new ze)));M(this,ce,H(R(new ze)));M(this,fe,H(R(new ze)));M(this,ve,H(!1))}get raster(){return u(x(this,ue))}set raster(e){b(x(this,ue),R(e))}get raster_dem(){return u(x(this,ce))}set raster_dem(e){b(x(this,ce),R(e))}get raster_overlay(){return u(x(this,fe))}set raster_overlay(e){b(x(this,fe),R(e))}get loaded(){return u(x(this,ve))}set loaded(e){b(x(this,ve),R(e))}}ue=new WeakMap,ce=new WeakMap,fe=new WeakMap,ve=new WeakMap;var Wt=N("<!> <!>",1),$t=N("<!> <!> <!> <!>",1),er=N('<div class="container svelte-1v4nnq4"><!></div>'),tr=N("<p>Loading...</p>");function rr(r,e){ee(e,!0);let t=K(e,"mapProps",15);const a=async()=>{var f,h,m,k,L,g;const o=await((f=e.data)==null?void 0:f.raster.header),d=await((h=e.data)==null?void 0:h.raster.metadata),v=await((m=e.data)==null?void 0:m.raster_dem.header),_=await((k=e.data)==null?void 0:k.raster_dem.metadata),l=await((L=e.data)==null?void 0:L.raster.header),c=await((g=e.data)==null?void 0:g.raster.metadata);return{raster_header:o,raster_metadata:d,raster_dem_header:v,raster_dem_metadata:_,raster_overlay_header:l,raster_overlay_metadata:c}};var s=B(),n=T(s);Dt(n,a,o=>{var d=tr();C(o,d)},(o,d)=>{var v=er(),_=I(v);Ft(_,{inlineStyle:`
        height: var(--map-height, 100%);
        width: var(--map-width, 100%);
      `,hash:!0,renderWorldCopies:!1,maxPitch:87,aroundCenter:!1,get center(){return t().center},set center(l){t(t().center=l,!0)},get zoom(){return t().zoom},set zoom(l){t(t().zoom=l,!0)},get bearing(){return t().bearing},set bearing(l){t(t().bearing=l,!0)},get pitch(){return t().pitch},set pitch(l){t(t().pitch=l,!0)},get roll(){return t().roll},set roll(l){t(t().roll=l,!0)},get elevation(){return t().elevation},set elevation(l){t(t().elevation=l,!0)},children:(l,c)=>{var f=$t(),h=T(f);const m=A(()=>{var i;return(i=e.data)==null?void 0:i.raster.url});qe(h,{get url(){return u(m)},children:(i,y)=>{Ze(i,{layout:{},paint:{"raster-resampling":"nearest"}})},$$slots:{default:!0}});var k=z(h,2);const L=A(()=>{var i;return(i=e.data)==null?void 0:i.raster_dem.url});Ve(k,{id:"terrain",get url(){return u(L)},encoding:"custom",baseShift:0,redFactor:256*256,greenFactor:256,blueFactor:1,children:(i,y)=>{var S=Wt(),Y=T(S);Gt(Y,{position:"top-right"});var ne=z(Y,2);Bt(ne,{exaggeration:10}),C(i,S)},$$slots:{default:!0}});var g=z(k,2);const P=A(()=>{var i;return(i=e.data)==null?void 0:i.raster_dem.url});Ve(g,{id:"hillshade",get url(){return u(P)},encoding:"custom",baseShift:0,redFactor:256*256,greenFactor:256,blueFactor:1,children:(i,y)=>{Ut(i,{paint:{"hillshade-exaggeration":1,"hillshade-shadow-color":"#000000","hillshade-accent-color":"#00000080","hillshade-highlight-color":"#ffffff00","hillshade-illumination-anchor":"map","hillshade-illumination-direction":0}})},$$slots:{default:!0}});var j=z(g,2);const q=A(()=>{var i;return(i=e.data)==null?void 0:i.raster_overlay.url});qe(j,{get url(){return u(q)},children:(i,y)=>{Ze(i,{layout:{},paint:{"raster-resampling":"nearest"}})},$$slots:{default:!0}}),C(l,f)},$$slots:{default:!0}}),D(v),C(o,v)}),C(r,s),te()}var ar=(r,e)=>b(e,u(e)-1),nr=N('<div class="viewer-add-remove svelte-1hoy4oy"><button class="svelte-1hoy4oy">â€“</button></div>'),sr=N('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),ir=N('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1),or=(r,e)=>b(e,u(e)+1),lr=N('<div class="viewer-add-remove svelte-1hoy4oy"><button class="svelte-1hoy4oy">+</button></div>'),dr=N('<!> <div class="main svelte-1hoy4oy"><div><!> <!> <!></div></div>',1);function _r(r,e){ee(e,!0);let t=H(2),a=H("Lens"),s=R({diameter:new ge(200,{duration:100,easing:Xe}),scaler:1.2,clientX:0,clientY:0,containerX:0,containerY:0,i:new ge(1,{duration:100,easing:Xe})});w(()=>{s.x=s.clientX-s.containerX,s.y=s.clientY-s.containerY});function n(i,y){y.containerX=i.getBoundingClientRect().left,y.containerY=i.getBoundingClientRect().top}function o(i){switch(i.key){case"'":s.diameter.target=Math.round(s.diameter.current*s.scaler),i.preventDefault();break;case";":s.diameter.target=Math.round(s.diameter.current/s.scaler),i.preventDefault();break;case"]":s.i.target-=1,i.preventDefault();break;case"[":s.i.target+=1,i.preventDefault();break;case"l":b(a,"Lens"),i.preventDefault();break;case"s":b(a,"Side by side"),i.preventDefault();break}}let d=A(()=>{let i=[];for(let y=0;y<u(t);y++)i.push(new Qt);return i}),v=A(()=>u(d).map(i=>i.loaded)),_=A(()=>{let i=[];for(let y=0;y<u(t);y++)u(d)[y].raster.pmtiles&&i.push(u(d)[y].raster.pmtiles),u(d)[y].raster_dem.pmtiles&&i.push(u(d)[y].raster_dem.pmtiles),u(d)[y].raster_overlay.pmtiles&&i.push(u(d)[y].raster_overlay.pmtiles);return i}),l=H(R({}));var c=dr();E("pointermove",He,i=>{s.clientX=i.clientX,s.clientY=i.clientY}),E("keyup",He,o);var f=T(c);{var h=i=>{It(i,{get pmtiles(){return u(_)}})};me(f,i=>{u(v).some(y=>y===!0)&&i(h)})}var m=z(f,2),k=I(m),L=I(k);{var g=i=>{var y=nr(),S=I(y);S.__click=[ar,t],D(y),C(i,y)};me(L,i=>{u(v).some(y=>y===!1)&&i(g)})}var P=z(L,2);Nt(P,17,()=>u(d),Ot,(i,y,S)=>{var Y=B(),ne=T(Y);{var Le=W=>{var se=sr(),U=T(se);const G=A(()=>u(a)==="Lens"&&u(v).every(Se=>Se===!0)&&S&&`circle(${s.diameter.current}px at ${s.x+s.diameter.current*2*(100/100)*(S-s.i.current)}px ${s.y}px)`);Ne(U,()=>({"--height":"100%","--width":"100%","--grid-row-start":1,"--grid-column-start":1,"--clippath":u(G)})),rr(U.lastChild,{get data(){return u(d)[S]},get mapProps(){return u(l)},set mapProps(Se){b(l,R(Se))}}),D(U),C(W,se)},tt=W=>{var se=ir(),U=T(se);Ne(U,()=>({"--width":"300px"})),Kt(U.lastChild,{loaded:()=>u(y).loaded=!u(y).loaded,get files(){return u(d)[S].raster.files},set files(G){u(d)[S].raster.files=G},get files_dem(){return u(d)[S].raster_dem.files},set files_dem(G){u(d)[S].raster_dem.files=G},get files_overlay(){return u(d)[S].raster_overlay.files},set files_overlay(G){u(d)[S].raster_overlay.files=G}}),D(U),C(W,se)};me(ne,W=>{u(y).loaded?W(Le):W(tt,!1)})}C(i,Y)});var j=z(P,2);{var q=i=>{var y=lr(),S=I(y);S.__click=[or,t],D(y),C(i,y)};me(j,i=>{u(v).some(y=>y===!1)&&i(q)})}D(k),jt(k,(i,y)=>n==null?void 0:n(i,y),()=>s),D(m),Je(i=>he(k,At(i),"svelte-1hoy4oy"),[()=>[u(a)==="Lens"&&u(v).every(i=>i===!0)?"viewers-grid":"viewers-flex"]]),C(r,c),te()}Ke(["click"]);export{_r as component};
